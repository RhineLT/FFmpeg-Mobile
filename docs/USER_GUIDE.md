# 应用使用指南

## 📱 视频压缩器 - 用户手册

### 目录
1. [安装和首次运行](#安装和首次运行)
2. [基本操作](#基本操作)
3. [高级功能](#高级功能)
4. [常见问题](#常见问题)
5. [技术说明](#技术说明)

---

## 安装和首次运行

### Android 安装
1. 下载 APK 文件（从 Release 页面或构建产物）
2. 启用"未知来源"应用安装（如需要）
3. 安装并打开应用
4. 首次启动时会请求以下权限：
   - **读取媒体文件**（Android 13+）
   - **存储权限**（Android 12 及以下）

### iOS 安装
1. 通过 TestFlight 或 App Store 安装
2. 首次启动时会请求**照片访问权限**

---

## 基本操作

### 1. 设置输出目录（可选）

应用会自动创建默认输出目录：
- **Android**: `/storage/emulated/0/Android/data/[package]/files/CompressedVideos`
- **iOS**: `Documents/CompressedVideos`

如需更改：
1. 点击顶部工具栏的📁图标
2. 选择新的输出目录

### 2. 选择视频

1. 点击底部的 **"选择视频"** 按钮
2. 浏览并选择一个或多个视频文件
3. 支持的格式：MP4, MOV, AVI, MKV, 3GP 等
4. 选中的视频会自动添加到任务列表

### 3. 开始压缩

**方式一：自动开始**
- 选择视频后，如果没有正在进行的任务，会自动开始压缩第一个视频

**方式二：手动控制**
1. 点击 **"开始压缩"** 按钮
2. 应用会按顺序处理队列中的视频
3. 每次只处理一个视频，避免性能问题

### 4. 监控进度

**主界面显示：**
- 📊 当前任务进度条
- ℹ️ 当前处理的文件名
- 📈 整体统计（待处理/已完成/失败）

**任务列表显示：**
- ⏳ 待处理（灰色）
- ▶️ 处理中（蓝色，带进度）
- ✅ 已完成（绿色）
- ❌ 失败（红色，显示错误）

### 5. 控制操作

**暂停/继续**
- 点击 **"暂停处理"** 停止当前任务
- 再次点击继续处理剩余任务

**停止所有**
- 点击 **"停止所有"** 取消所有待处理任务
- 当前正在处理的任务会完成

---

## 高级功能

### 查看日志

1. 点击顶部的📄图标进入日志界面
2. 日志类型：
   - 🟦 **INFO**：正常操作记录
   - 🟨 **WARNING**：警告信息
   - 🟥 **ERROR**：错误详情
   - ⚪ **DEBUG**：调试信息

3. 功能：
   - 按类型筛选
   - 搜索关键词
   - 复制日志信息

### 任务管理

**清除已完成的任务**
1. 点击右上角的 **⋮** 菜单
2. 选择 **"清除已完成"**
3. 所有已完成的任务将被移除

**清除所有任务**
1. 点击右上角的 **⋮** 菜单
2. 选择 **"清除所有"**
3. 确认操作
4. ⚠️ 这会删除所有任务（包括待处理的）

**重试失败的任务**
1. 在任务列表中找到失败的任务（红色）
2. 点击任务卡片
3. 选择 **"重试"**
4. 任务会重新加入队列

### 断点续传

应用支持中途退出后恢复：

1. **正常情况**：
   - 关闭应用后，所有任务状态都会保存
   - 重新打开应用时自动加载任务列表
   - 正在处理的任务会被重置为"待处理"

2. **恢复处理**：
   - 打开应用
   - 检查任务列表
   - 点击"开始压缩"继续处理

---

## 常见问题

### Q1: 为什么压缩后的文件反而更大？

**可能原因：**
- 原视频已经高度压缩
- 原视频质量很低
- 原视频使用了更高效的编码

**解决方案：**
- 检查原视频的编码格式
- 对于已优化的视频，建议不再压缩

### Q2: 压缩速度很慢？

**影响因素：**
- 视频分辨率（4K > 1080p > 720p）
- 视频时长
- 设备性能
- 当前设备负载

**优化建议：**
- 关闭其他应用
- 为设备充电（避免节能模式）
- 一次处理较少的视频

### Q3: 压缩失败怎么办？

**排查步骤：**
1. 查看日志了解具体错误
2. 检查存储空间是否充足
3. 验证输入文件是否完整
4. 检查输出目录是否可写
5. 重启应用后重试

### Q4: 如何获得最佳压缩效果？

**建议设置：**
- 本应用使用 H.265 编码（相当于 CRF 28）
- 自动保留音频
- 不删除原文件（便于对比）

**预期效果：**
- 文件大小：通常减小 30-70%
- 质量损失：肉眼难以察觉
- 压缩比：取决于原视频编码

### Q5: 权限被拒绝？

**Android 13+：**
1. 打开系统设置
2. 应用 → 视频压缩器
3. 权限 → 启用"照片和视频"

**Android 12 及以下：**
1. 打开系统设置
2. 应用 → 视频压缩器
3. 权限 → 启用"存储"

**iOS：**
1. 打开系统设置
2. 隐私 → 照片
3. 找到应用并允许访问

---

## 技术说明

### 压缩原理

**Android**：
- 使用 MediaCodec API
- 硬件加速编码（如果支持）
- H.264/H.265 编码

**iOS**：
- 使用 AVAssetExportSession
- 硬件加速编码
- H.264/HEVC 编码

### 质量设置

本应用使用 **DefaultQuality** 预设，大致相当于：
- **CRF 28**（FFmpeg 标准）
- 高质量输出
- 良好的文件大小
- 兼容性好

### 性能优化

1. **单任务处理**：
   - 避免多任务并发导致的性能下降
   - 减少内存占用
   - 提高稳定性

2. **智能队列**：
   - 自动管理待处理任务
   - 按添加顺序处理
   - 失败任务可重试

3. **资源管理**：
   - 及时释放压缩资源
   - 避免内存泄漏
   - 优化电池使用

### 数据存储

**本地存储内容：**
- 任务列表（SharedPreferences）
- 输出目录路径
- 日志记录（内存中）

**不存储：**
- 视频文件本身
- 用户个人信息
- 网络数据

---

## 支持和反馈

### 问题报告

遇到问题？请提供：
1. 设备型号和系统版本
2. 应用版本
3. 详细的操作步骤
4. 日志截图
5. 如果可能，提供测试视频

### 功能建议

欢迎提出改进建议：
- GitHub Issues
- 应用内反馈

### 更新日志

访问 GitHub Release 页面查看：
- 新功能
- Bug 修复
- 性能优化

---

**享受视频压缩！** 🎉
