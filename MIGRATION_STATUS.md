# FFmpeg Kit Flutter New è¿ç§»è¿›åº¦æŠ¥å‘Š

## ğŸ“‹ è¿ç§»æ¦‚è§ˆ

**æ—¥æœŸ**: 2025-10-29  
**ç‰ˆæœ¬**: 1.0.0+1  
**çŠ¶æ€**: ğŸ”„ è¿›è¡Œä¸­ - ç­‰å¾… CI/CD éªŒè¯

---

## âœ… å·²å®Œæˆ

### 1. ä¾èµ–è¿ç§»
- âœ… æ›¿æ¢ `video_compress` â†’ `ffmpeg_kit_flutter_new ^4.1.0`
- âœ… é€‰æ‹© Full-GPL åŒ… (åŒ…å«æ‰€æœ‰ç¼–è§£ç å™¨)
- âœ… æ›´æ–° `pubspec.yaml`

### 2. æ ¸å¿ƒæœåŠ¡é‡å†™
- âœ… `lib/services/video_compression_service.dart` å®Œå…¨é‡å†™
  - ä½¿ç”¨ `FFmpegKit.executeAsync()` æ‰§è¡Œå‹ç¼©
  - ä½¿ç”¨ `FFprobeKit.getMediaInformation()` è¯»å–è§†é¢‘ä¿¡æ¯
  - å®ç°å®æ—¶è¿›åº¦å›è°ƒ
  - æ„å»ºå®Œæ•´çš„ FFmpeg å‘½ä»¤è¡Œå‚æ•°

### 3. FFmpeg å‘½ä»¤æ„å»º
- âœ… æ”¯æŒ CRF è´¨é‡æ§åˆ¶ (18-36)
- âœ… æ”¯æŒ Preset é€Ÿåº¦æ§åˆ¶ (ultrafast-veryslow)
- âœ… æ”¯æŒè‡ªå®šä¹‰åˆ†è¾¨ç‡ (`-s` å‚æ•°)
- âœ… æ”¯æŒè‡ªå®šä¹‰å¸§ç‡ (`-r` å‚æ•°)
- âœ… æ”¯æŒç ç‡é™åˆ¶ (`-maxrate`, `-bufsize`)
- âœ… ç¡¬ä»¶åŠ é€Ÿé€‰é¡¹:
  - Android: `hevc_mediacodec`
  - iOS/macOS: `hevc_videotoolbox`
  - è½¯ä»¶: `libx265`

### 4. å¹³å°é…ç½®
- âœ… Android minSdk = 24 (å·²æ»¡è¶³)
- âœ… iOS deployment target = 14.0 (åˆšä¿®å¤)
- âœ… åˆ›å»º `ios/Podfile` é…ç½®æ–‡ä»¶

### 5. UI æ›´æ–°
- âœ… è®¾ç½®ç•Œé¢æ›´æ–°æç¤ºæ–‡å­—
  - åˆ†è¾¨ç‡: "âœ… åˆ†è¾¨ç‡è®¾ç½®å·²ç”Ÿæ•ˆ (ä½¿ç”¨ FFmpeg Kit)"
  - å¸§ç‡: "âœ… å¸§ç‡è®¾ç½®å·²ç”Ÿæ•ˆ"

### 6. ä»£ç è´¨é‡
- âœ… `flutter analyze` - æ— é”™è¯¯
- âœ… `flutter test` - 7/7 æµ‹è¯•é€šè¿‡
- âœ… ä»£ç æ ¼å¼åŒ–å®Œæˆ

### 7. æ–‡æ¡£
- âœ… åˆ›å»º `MIGRATION_FFMPEG_KIT.md`
- âœ… è¯¦ç»†è¯´æ˜è¿ç§»åŸå› å’Œæ–°åŠŸèƒ½

---

## ğŸ”„ è¿›è¡Œä¸­

### CI/CD æ„å»ºæµ‹è¯•
- ğŸ”„ Android APK æ„å»º (é¢„è®¡æˆåŠŸ)
- ğŸ”„ iOS IPA æ„å»º (å·²ä¿®å¤ deployment target)

**æœ€æ–°æäº¤**:
```bash
3daa886 - fix: è®¾ç½® iOS deployment target ä¸º 14.0
8f033b7 - docs: æ·»åŠ  FFmpeg Kit è¿ç§»æ–‡æ¡£
ad0ffd0 - feat: æ›´æ–°è§†é¢‘å‹ç¼©æœåŠ¡ (FFmpeg Kit å®ç°)
```

---

## ğŸ“Š åŠŸèƒ½å¯¹æ¯”

| åŠŸèƒ½ | video_compress | ffmpeg_kit_flutter_new |
|------|----------------|------------------------|
| H.265 ç¼–ç  | âš ï¸ å¹³å°ç›¸å…³ | âœ… å®Œæ•´æ”¯æŒ |
| CRF æ§åˆ¶ | âŒ ä¸æ”¯æŒ | âœ… æ”¯æŒ |
| Preset æ§åˆ¶ | âŒ ä¸æ”¯æŒ | âœ… æ”¯æŒ |
| è‡ªå®šä¹‰åˆ†è¾¨ç‡ | âŒ ä¸æ”¯æŒ | âœ… æ”¯æŒ |
| è‡ªå®šä¹‰å¸§ç‡ | âš ï¸ éƒ¨åˆ†æ”¯æŒ | âœ… å®Œæ•´æ”¯æŒ |
| ç¡¬ä»¶åŠ é€Ÿ | âœ… è‡ªåŠ¨ | âœ… å¯æ§åˆ¶ |
| è‡ªå®šä¹‰å‚æ•° | âŒ ä¸æ”¯æŒ | âœ… æ”¯æŒ |
| è¿›åº¦å›è°ƒ | âœ… æ”¯æŒ | âœ… æ”¯æŒ |
| åŒ…å¤§å° | ~5MB | ~50MB |

---

## âš ï¸ å·²çŸ¥é—®é¢˜ä¸è§£å†³

### 1. iOS CocoaPods ä¾èµ–é”™è¯¯ âœ… å·²è§£å†³
**é”™è¯¯**:
```
Specs satisfying the `ffmpeg_kit_flutter_new/full-gpl (= 1.0.0)` 
dependency were found, but they required a higher minimum deployment target.
```

**è§£å†³æ–¹æ¡ˆ**:
- åˆ›å»º `ios/Podfile` æ–‡ä»¶
- è®¾ç½® `platform :ios, '14.0'`
- åœ¨ `post_install` ä¸­å¼ºåˆ¶æ‰€æœ‰ target ä½¿ç”¨ iOS 14.0

### 2. åŒ…å¤§å°å¢åŠ 
- **åŸå› **: Full-GPL åŒ…å«å®Œæ•´ FFmpeg åº“
- **å½±å“**: APK/IPA å¤§å°å¢åŠ çº¦ 45MB
- **ç¼“è§£**: å¯è€ƒè™‘åˆ‡æ¢åˆ° `min-gpl` åŒ…å‡å°ä½“ç§¯

---

## ğŸ¯ ä¸‹ä¸€æ­¥

1. â³ ç­‰å¾… CI/CD æ„å»ºå®Œæˆ
2. ğŸ“± åœ¨å®é™…è®¾å¤‡ä¸Šæµ‹è¯•å‹ç¼©åŠŸèƒ½
3. ğŸ” éªŒè¯æ‰€æœ‰å‚æ•°è®¾ç½®ç”Ÿæ•ˆ
4. ğŸ“ˆ æ€§èƒ½æµ‹è¯•å’Œä¼˜åŒ–
5. ğŸ“ æ›´æ–°ç”¨æˆ·æ–‡æ¡£

---

## ğŸš€ é¢„æœŸæ”¹è¿›

- **çœŸæ­£çš„ H.265**: ä½¿ç”¨ `libx265` ç¼–ç å™¨
- **ç²¾ç¡®æ§åˆ¶**: CRFã€presetã€åˆ†è¾¨ç‡ã€å¸§ç‡å…¨éƒ¨å¯æ§
- **ä¸“ä¸šçº§**: æ”¯æŒè‡ªå®šä¹‰ FFmpeg å‚æ•°
- **è·¨å¹³å°ä¸€è‡´**: Android å’Œ iOS è¡Œä¸ºä¸€è‡´

---

## ğŸ“ ç›‘æ§å‘½ä»¤

```bash
# æŸ¥çœ‹æœ€æ–° CI/CD çŠ¶æ€
gh run list --limit 1

# æŸ¥çœ‹å…·ä½“æ—¥å¿—
gh run view --log-failed

# æœ¬åœ°æµ‹è¯•
flutter analyze
flutter test
```

---

**çŠ¶æ€**: ç­‰å¾… CI/CD éªŒè¯ iOS ä¿®å¤... â³
